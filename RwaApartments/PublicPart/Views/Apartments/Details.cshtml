@model PublicPart.Models.ViewModels.DetailsViewModel

@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";

    IList<SelectListItem> ddlStars = new List<SelectListItem>()
{
        new SelectListItem{Text = "1", Value = "1"},
        new SelectListItem{Text = "2", Value = "2"},
        new SelectListItem{Text = "3", Value = "3"},
        new SelectListItem{Text = "4", Value = "4"},
        new SelectListItem{Text = "5", Value = "5"}
    };
}

<h1>Index</h1>

<div class="container mar">

    <div class="row justify-content-center mb-3">
        <div class="col-sm-8 mt-2">
            <h2>@Model.Apartment.NameEng</h2>
        </div>
    </div>

    <div class="row mb-4 justify-content-center">
        <div class="col-sm-8">
            <div id="carouselExampleCaptions" class="carousel slide overflow-hidden" data-bs-ride="false">
                <div class="carousel-inner">

                    <div class="carousel-item active">
                        <img runat="server" src="@Url.Action("Picture", "Apartments", new { path = (Model.Apartment.Images.ElementAt(0)).Path })" id="imgActive" class="d-block w-100" alt="Representative picture" style="height: 25rem">
                        <div class="carousel-caption d-none d-md-block">
                            <h3 style="text-shadow: 2px 2px #000000">@Model.Apartment.Images.ElementAt(0).Name</h3>
                        </div>
                    </div>

                    @foreach (var image in Model.Apartment.Images.Skip(1))
                    {
                        <div class="carousel-item">
                            <img class="d-block w-100" style="height: 25rem" src="@Url.Action("Picture", "Apartments", new { path = image.Path })" alt="Second slide">
                            <div class="carousel-caption d-none d-md-block">
                                <h3 style="text-shadow: 2px 2px #000000">@image.Name</h3>
                            </div>
                        </div>
                    }

                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
    </div>

    <div class="row mb-4 justify-content-center">
        <div class="col-sm-8 scroll" style="overflow-x: scroll">
            @foreach (var tag in Model.Apartment.Tags)
            {
                <span class="badge bg-light text-dark">@tag.NameEng</span>
            }
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-sm-8">
            <div class="d-flex justify-content-between">
                <div>
                    <img src="~/Content/Resources/geo-alt-fill.svg" />
                    @Html.Label(Model.Apartment.City.NameCity)
                </div>

                <div>
                    <img src="~/Content/Resources/bed.svg" style="width: 1.5rem; height: 1.5rem" class="mx-1" />
                    @Html.Label(Model.Apartment.ToString())
                </div>

                <div>
                    <img src="~/Content/Resources/beach.svg" style="width: 1.5rem; height: 1.5rem" class="mx-1" />
                    @Html.Label(Model.Apartment.BeachDistance.ToString() + " m")
                </div>

                <div>
                    <img src="~/Content/Resources/person.svg" style="width: 1.5rem; height: 1.5rem" class="mx-1" />
                    @Html.Label(Model.Apartment.MaxAdults.ToString())
                </div>

                <div>
                    <img src="~/Content/Resources/child.svg" style="width: 1.5rem; height: 1.5rem" class="mx-1" />
                    @Html.Label(Model.Apartment.MaxChildren.ToString())
                </div>

                <div>
                    <img src="~/Content/Resources/coin.svg" class="mx-1" />
                    @Html.Label(Model.Apartment.Price.ToString("F"))
                </div>
            </div>
        </div>

    </div>

    <div class="row justify-content-center">
        <div class="col-sm-8"><hr /></div>
    </div>


    <!--<div class="">-->
    @using (Html.BeginForm(controllerName: "Apartments", actionName: "", method: FormMethod.Post))
    {
        @Html.AntiForgeryToken()
        <div class="row justify-content-center">
            <div class="col-sm-8">
                <h3>Contact us</h3>
            </div>
        </div>

        <div class="row justify-content-center mb-2">
            <div class="form-group col-sm-4">
                @Html.LabelFor(model => model.Name, new { @class = "control-label" })
                <div class="">
                    @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Name)
                </div>
            </div>

            <div class="form-group col-sm-4">
                @Html.LabelFor(model => model.Email, new { @class = "control-label" })
                <div class="">
                    @Html.EditorFor(model => model.Email, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Email)
                </div>
            </div>

        </div>

        <div class="row justify-content-center mb-2">
            <div class="form-group col-sm-4">
                @Html.LabelFor(model => model.PhoneNumber, new { @class = "control-label" })
                <div class="">
                    @Html.EditorFor(model => model.PhoneNumber, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.PhoneNumber)
                </div>
            </div>


            <div class="form-group col-sm-2">
                @Html.LabelFor(model => model.Adults, new { @class = "control-label" })
                <div class="">
                    @Html.EditorFor(model => model.Adults, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Adults)
                </div>
            </div>

            <div class="form-group col-sm-2">
                @Html.LabelFor(model => model.Children, new { @class = "control-label" })
                <div class="">
                    @Html.EditorFor(model => model.Children, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Children)
                </div>
            </div>

        </div>

        <div class="row justify-content-center mb-2">
            <div class="form-group col-sm-4">
                @Html.LabelFor(model => model.StartDate, new { @class = "control-label" })
                <div class="">
                    @*@Html.EditorFor(model => model.StartDate, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.StartDate)*@
                    <input type="date"/>
                </div>
            </div>

            <div class="form-group col-sm-4">
                @Html.LabelFor(model => model.EndDate, new { @class = "control-label" })
                <div class="">
                    @Html.EditorFor(model => model.EndDate, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.EndDate)
                </div>
            </div>

        </div>

        <div class="row justify-content-center">
            <div class="col-sm-8">
                <button type="submit" class="btn btn-success" id="btnContact">Send</button>
            </div>
        </div>
    }
    @*</div>*@

    @if (HttpContext.Current.User.Identity.IsAuthenticated)
    {
        <div class="row justify-content-center">
            <div class="col-sm-8"><hr /></div>
        </div>

        <div class="row justify-content-center">
            <div class="row justify-content-center mb-2">
                <div class="col-sm-8">
                    <h3>Leave a review</h3>
                </div>
            </div>
            <div class="col-sm-3">
                <textarea id="txtDetails" class="form-control scroll customTextArea"></textarea>
            </div>

            <div class="col-sm-3 my-auto">
                <div class="d-flex">
                    @Html.DropDownList(
                   name: "Stars",
                   optionLabel: null,
                    selectList: ddlStars,
                    htmlAttributes: new { @class = "form-controls mx-2", id = "ddlStars" })

                    <img src="~/Content/Resources/star-fill.svg" />
                </div>
                <button class="btn btn-primary mx-2 mt-2" id="btnAddReview" type="submit">Add review</button>
            </div>


        </div>
    }


    <div class="row justify-content-center">
        <div class="col-sm-8"><hr /></div>
    </div>

    <div class="row justify-content-center">
        <div class="col-sm-8">
            <h3>Reviews</h3>
            <div class="row row-cols-2">
                @foreach (var review in Model.Reviews)
                {
                    <div class="card" style="height: 23vh">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <h5>@review.UserName</h5>
                                <p>@review.CreatedAt.ToShortDateString()</p>
                            </div>
                            <div class="card-title float-end">
                                <span>@review.Stars</span>
                                <img src="~/Content/Resources/star-fill.svg" />
                            </div>
                            <p class="card-text overflow-scroll scroll">
                                @review.Details
                                @if (review.Details == string.Empty)
                                {
                                    <span>No review yet...</span>
                                }
                            </p>
                        </div>
                    </div>
                }
            </div>
        </div>

    </div>

    <div class="row justify-content-center">
        <div class="col-sm-8"><hr /></div>
    </div>

</div>

@section scripts{
    <script>

        $("#btnAddReview").on("click", function (e) {
            e.preventDefault();
            var apartmentId = @Model.Apartment.Id;
            var details = $("#txtDetails").val();
            var stars = $("#ddlStars").val();
            var idUser = @Model.IdUser;
            $.ajax({
                url: "@Url.Action("AddReview", "Apartments")",
                type: "POST",
                data: { apartmentId, details, stars, idUser },
                success: function () {
                    console.log("Success");
                    $("#txtDetails").val("");
                    $("#ddlStars").val(1);
                }
            });
        });

    </script>
}